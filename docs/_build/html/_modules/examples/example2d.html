
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>examples.example2d &#8212; vkikriging 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">vkikriging 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for examples.example2d</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example surrogate modelling in 2d (`examples/example2d`)</span>
<span class="sd">========================================================</span>

<span class="sd">Class to do surrogate modelling and plotting of a function `f` of two variables, with </span>
<span class="sd">derivative, another function `df`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">vkikriging.mylib</span> <span class="k">import</span> <span class="p">(</span>
	<span class="n">covariance_to_stddev</span><span class="p">,</span>
	<span class="n">enter_debugger_on_uncaught_exception</span><span class="p">,</span>
	<span class="n">iowrite</span><span class="p">,</span>
	<span class="n">gek_separate</span><span class="p">,</span>
	<span class="n">get_aspect</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">vkikriging</span> <span class="k">import</span> <span class="n">test_functions</span><span class="p">,</span> <span class="n">sampling</span>
<span class="kn">from</span> <span class="nn">vkikriging</span> <span class="k">import</span> <span class="n">kriging_v1</span><span class="p">,</span> <span class="n">kriging_v2</span><span class="p">,</span> <span class="n">kriging_v3</span>

<div class="viewcode-block" id="Example2d"><a class="viewcode-back" href="../../example2d.html#examples.example2d.Example2d">[docs]</a><span class="k">class</span> <span class="nc">Example2d</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Example demonstrating how to use kriging and gek, versions v1,v2 and v3, in 2d.</span>
<span class="sd">	For a function `f` (e.g. analytically defined), with gradient `df`.</span>

<span class="sd">	Args:</span>
<span class="sd">	  f (test_functions.TestFunction): Function to approximate, includes derivate,</span>
<span class="sd">	                                   and bounds in each coodinate direction.  See</span>
<span class="sd">	                                   `test_functions` for examples.</span>
<span class="sd">	  xi_samples (ndarray): Locations xi at which to sample `f` and `df`, shape `(N,2)`.</span>
<span class="sd">	  gamma (float): Correlation length in prior.</span>
<span class="sd">	  sigma_d, sigma_dg (float): Standard errors in observations and gradients.</span>

<span class="sd">	Example usage::</span>

<span class="sd">	  from vkikriging.test_functions import Camel</span>
<span class="sd">	  from vkikriging.sampling import sobol</span>

<span class="sd">	  # 1. Initialize the function to approxiate, samples and Kriging paramters</span>
<span class="sd">	  f = Camel()</span>
<span class="sd">	  xi = sobol(20, 2) * (f.xmax - f.xmin) + f.xmin</span>
<span class="sd">	  ex2d = Example2d(f, xi, gamma, sigma_d, sigma_dg)</span>

<span class="sd">	  # 2. Build the Kriging model, v1, v2 or v3.  For v1, v2 GEK model is also built.</span>
<span class="sd">	  ex2d.build_surrogate_v1()</span>

<span class="sd">	  # 3. Plot the model</span>
<span class="sd">	  ex2d.plot_contours()</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">xi_samples</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">sigma_d</span><span class="p">,</span> <span class="n">sigma_dg</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n_o</span> <span class="o">=</span> <span class="n">xi_samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xi_o</span> <span class="o">=</span> <span class="n">xi_samples</span>

		<span class="c1"># Define reconstruction locations - use rectangular grid.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">41</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">**</span> <span class="mi">2</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
		<span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xi_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">A</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">B</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span>

		<span class="c1"># Put everything together - repeated coordinates are okay.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_o</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_r</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r</span><span class="p">))</span>

		<span class="c1"># State which of the coordinates will be observed (in this case the first n_o).</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">observed</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_o</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

		<span class="c1"># Observe the function (we also observe the reconstruction locations for reference)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">xi_i</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">xi_i</span><span class="p">)</span>

		<span class="c1"># Specify parameters of the prior</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sigma_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_dg</span> <span class="o">=</span> <span class="n">sigma_d</span><span class="p">,</span> <span class="n">sigma_dg</span>	 <span class="c1"># Obvervation error.</span>
		<span class="c1"># Sample mean + (conservative) stddev estimate.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="Example2d.build_surrogate_v1"><a class="viewcode-back" href="../../example2d.html#examples.example2d.Example2d.build_surrogate_v1">[docs]</a>	<span class="k">def</span> <span class="nf">build_surrogate_v1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building simple Kriging model (version 1):&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">krig</span> <span class="o">=</span> <span class="n">kriging_v1</span><span class="o">.</span><span class="n">kriging</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span>
								  <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">)</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building simple GEK model (version 1):&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gek</span> <span class="o">=</span> <span class="n">kriging_v1</span><span class="o">.</span><span class="n">gek</span><span class="p">(</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_dg</span><span class="p">,</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
		<span class="p">)</span></div>

<div class="viewcode-block" id="Example2d.build_surrogate_v2"><a class="viewcode-back" href="../../example2d.html#examples.example2d.Example2d.build_surrogate_v2">[docs]</a>	<span class="k">def</span> <span class="nf">build_surrogate_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># WORKING</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">krig</span> <span class="o">=</span> <span class="n">kriging_v2</span><span class="o">.</span><span class="n">Kriging</span><span class="p">(</span><span class="n">xi_o</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="n">n_o</span><span class="p">],</span> <span class="n">sigma_d</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gek</span> <span class="o">=</span> <span class="n">kriging_v2</span><span class="o">.</span><span class="n">GEK</span><span class="p">(</span>
				<span class="n">xi_o</span><span class="p">,</span> <span class="n">x</span><span class="p">[:</span><span class="n">n_o</span><span class="p">],</span> <span class="n">dx</span><span class="p">[:</span><span class="n">n_o</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sigma_d</span><span class="p">,</span> <span class="n">sigma_dg</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">gamma</span>
			<span class="p">)</span>
		<span class="n">k2mean</span><span class="p">,</span> <span class="n">k2cov</span> <span class="o">=</span> <span class="n">krig</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xi_r</span><span class="p">,</span> <span class="n">posterior_cov</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
		<span class="n">kr</span> <span class="o">=</span> <span class="n">k2mean</span><span class="p">[:</span><span class="n">n_r</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
		<span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">k2cov</span><span class="p">[:</span><span class="n">n_r</span><span class="p">,</span> <span class="p">:</span><span class="n">n_r</span><span class="p">])))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span></div>

<div class="viewcode-block" id="Example2d.build_surrogate_v3"><a class="viewcode-back" href="../../example2d.html#examples.example2d.Example2d.build_surrogate_v3">[docs]</a>	<span class="k">def</span> <span class="nf">build_surrogate_v3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># WORKING</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">gek</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Example2d.plot_contours"><a class="viewcode-back" href="../../example2d.html#examples.example2d.Example2d.plot_contours">[docs]</a>	<span class="k">def</span> <span class="nf">plot_contours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>		
		<span class="n">axes</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="mi">21</span><span class="p">)</span>
		<span class="c1"># Top row - values of f</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">xf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_o</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">xopt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">xopt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Reference, min={np.min(xf):.2f}&#39;</span><span class="p">)</span>
		
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">krigf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">krig</span><span class="p">[</span><span class="s1">&#39;muhat&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">n_o</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">krigf</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">krigf</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;xr&#39;</span><span class="p">)</span>		
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">xopt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">xopt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Kriging, min={np.min(krigf):.2f}&#39;</span><span class="p">)</span>
		
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">gekf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gek_separate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gek</span><span class="p">[</span><span class="s1">&#39;muhat&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">gekf</span> <span class="o">=</span> <span class="n">gekf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_o</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
		<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">gekf</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;xr&#39;</span><span class="p">)</span>		
		<span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">gekf</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">xopt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">xopt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;GEK, min={np.min(gekf):.2f}&#39;</span><span class="p">)</span>
		
		<span class="c1"># Middle row - true error</span>
		<span class="n">errcmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">)</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">krigerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">krigf</span><span class="o">-</span><span class="n">xf</span><span class="p">)</span>
		<span class="n">levelserr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">krigerr</span><span class="p">),</span> <span class="mi">21</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">krigerr</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levelserr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">errcmap</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Kriging error, mse={np.sqrt(np.mean(krigerr**2)):.2f}&#39;</span><span class="p">)</span>
		
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">gekerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gekf</span><span class="o">-</span><span class="n">xf</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">gekerr</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levelserr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">errcmap</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;GEK error, mse={np.sqrt(np.mean(gekerr**2)):.2f}&#39;</span><span class="p">)</span>

		<span class="c1"># Bottom row - prediction stddev</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">krigsd</span> <span class="o">=</span> <span class="n">covariance_to_stddev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">krig</span><span class="p">[</span><span class="s1">&#39;Sigmahat&#39;</span><span class="p">])[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_o</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
		<span class="n">levelserr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">krigerr</span><span class="p">),</span> <span class="mi">21</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">krigsd</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levelserr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">errcmap</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Kriging stddev, mse={np.sqrt(np.mean(krigsd**2)):.2f}&#39;</span><span class="p">)</span>
		
		<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">geksd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gek_separate</span><span class="p">(</span><span class="n">covariance_to_stddev</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gek</span><span class="p">[</span><span class="s1">&#39;Sigmahat&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> 
		<span class="n">geksd</span> <span class="o">=</span> <span class="n">geksd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_o</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_r1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_r2</span><span class="p">,</span> <span class="n">geksd</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levelserr</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">errcmap</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;GEK stddev, mse={np.sqrt(np.mean(geksd**2)):.2f}&#39;</span><span class="p">)</span>

		<span class="c1"># Make pretty</span>
		<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
		<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]):</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xi_o</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi_o</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\xi_1$&#39;</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\xi_2$&#39;</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		
		<span class="n">iowrite</span><span class="p">(</span><span class="s1">&#39;example2d.pdf&#39;</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Figure_2.png&#39;</span><span class="p">)</span></div></div>


		<span class="c1"># Run it.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">enter_debugger_on_uncaught_exception</span><span class="p">()</span>

	<span class="kn">from</span> <span class="nn">vkikriging.sampling</span> <span class="k">import</span> <span class="n">sobol</span><span class="p">,</span><span class="n">halton</span>
	
	<span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">test_functions</span><span class="o">.</span><span class="n">NoisyParabola</span><span class="p">()</span>
	<span class="n">xi</span> <span class="o">=</span> <span class="n">halton</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">f</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">xmin</span>
	<span class="n">gamma</span><span class="p">,</span> <span class="n">sigma_d</span><span class="p">,</span> <span class="n">sigma_dg</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.00001</span>
	<span class="n">ex2d</span> <span class="o">=</span> <span class="n">Example2d</span><span class="p">(</span>
		<span class="n">f</span><span class="p">,</span>
		<span class="n">xi</span><span class="p">,</span>
		<span class="n">gamma</span><span class="p">,</span>
		<span class="n">sigma_d</span><span class="p">,</span>
		<span class="n">sigma_dg</span><span class="p">,</span>
	<span class="p">)</span>
	<span class="n">ex2d</span><span class="o">.</span><span class="n">build_surrogate_v1</span><span class="p">()</span>
	<span class="n">ex2d</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">vkikriging 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, R.P. Dwight.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>